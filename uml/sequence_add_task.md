# Диаграмма последовательности: Добавление задачи

```mermaid
sequenceDiagram
    participant User as Пользователь
    participant Main as main.py
    participant UI as ui.py
    participant Logic as logic.py
    participant Data as data.py
    participant File as tasks.json
    
    User->>Main: Запуск приложения
    Main->>Data: load_tasks()
    Data->>File: Чтение tasks.json
    File-->>Data: Список задач
    Data-->>Main: tasks: List[dict]
    
    Main->>UI: show_menu()
    UI-->>User: Отображение меню
    User->>Main: Выбор пункта "2" (Добавить задачу)
    
    Main->>UI: get_task_input()
    UI-->>User: Запрос названия задачи
    User->>UI: Ввод названия
    UI-->>User: Запрос описания задачи
    User->>UI: Ввод описания (опционально)
    UI-->>Main: task_data: {name, description}
    
    Main->>Logic: add_task(tasks, task_data)
    Logic->>Logic: Генерация нового ID
    Note over Logic: ID = max(existing_ids) + 1<br/>или 1, если список пуст
    Logic->>Logic: Создание задачи с полями:<br/>id, name, description, status="новая"
    Logic->>Logic: Добавление задачи в список
    Logic-->>Main: None (задача добавлена in-place)
    
    Main->>Data: save_tasks(tasks)
    Data->>Data: Сериализация в JSON (ensure_ascii=False)
    Data->>File: Запись в tasks.json (UTF-8, indent=4)
    File-->>Data: Подтверждение записи
    Data-->>Main: None (успешное сохранение)
    
    Main->>UI: show_menu()
    UI-->>User: Возврат в главное меню
```

## Описание взаимодействий

### Шаг 1: Запуск приложения
Модуль `main.py` загружает существующие задачи из файла через `load_tasks()` из модуля `data.py`.

### Шаг 2: Отображение меню
Модуль `main.py` вызывает `show_menu()` из модуля `ui.py` для отображения главного меню.

### Шаг 3: Выбор операции
Пользователь выбирает пункт меню "2" (Добавить задачу).

### Шаг 4: Ввод данных задачи
Модуль `main.py` вызывает `get_task_input()` из модуля `ui.py`, которая запрашивает у пользователя:
- Название задачи (обязательное поле)
- Описание задачи (опциональное поле)

Функция возвращает словарь `task_data` с ключами `name` и `description`.

### Шаг 5: Добавление задачи в логику
Модуль `main.py` передает список задач и данные новой задачи в функцию `add_task()` модуля `logic.py`.

Модуль `logic.py`:
- Генерирует уникальный ID (максимальный существующий ID + 1, или 1 если список пуст)
- Создает новую задачу со структурой:
  ```python
  {
      "id": <новый_id>,
      "name": <название>,
      "description": <описание>,
      "status": "новая"
  }
  ```
- Добавляет задачу в список
- Возвращает обновленный список задач

### Шаг 6: Сохранение задач
Модуль `main.py` вызывает `save_tasks(tasks)` из модуля `data.py` для сохранения обновленного списка.

Модуль `data.py`:
- Сериализует список задач в JSON-формат с отступами (indent=4)
- Использует UTF-8 кодировку и ensure_ascii=False для корректного отображения кириллицы
- Записывает данные в файл `tasks.json`
- Если файл не существует - создает его

### Шаг 7: Возврат в меню
Модуль `main.py` возвращает пользователя в главное меню через `show_menu()`.

## Альтернативные потоки

### Ошибка при чтении файла
Если при чтении `tasks.json` возникает ошибка (например, файл поврежден), модуль `data.py` должен обработать исключение и вернуть пустой список или вывести сообщение об ошибке.

### Ошибка при записи файла
Если при записи в `tasks.json` возникает ошибка (например, нет прав доступа), модуль `data.py` логирует ошибку и обрабатывает исключение. Ошибка может быть обработана в `main.py` с выводом сообщения пользователю.

